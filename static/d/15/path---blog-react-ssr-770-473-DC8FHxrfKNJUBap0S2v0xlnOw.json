{"data":{"site":{"siteMetadata":{"title":"dwb-blog","author":"dwb"}},"markdownRemark":{"id":"d1996268-87cd-5462-9912-54dc736a8aad","html":"<h2>ä¸€ã€ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¸²æŸ“ï¼š</h2>\n<p>æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰åŒºåˆ«äºå®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰ï¼Œå½“ç”¨æˆ·è®¿é—®ä¸€ä¸ªç½‘å€çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯æ¸²æŸ“åˆ™æ˜¯æœåŠ¡ç«¯è¿”å›ä¸€éƒ¨åˆ† HTML ç»“æ„ï¼Œé€šè¿‡æ‰§è¡Œ JavaScript å°†ä½™ä¸‹çš„ HTML æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼Œè€ŒæœåŠ¡ç«¯æ¸²æŸ“åˆ™æ˜¯åœ¨æœåŠ¡ç«¯ç”Ÿæˆå®Œæ•´çš„ HTML ç»“æ„è¿”å›ç»™æµè§ˆå™¨ã€‚\nä»¥ React ä¸ºä¾‹ï¼šåœ¨å®¢æˆ·ç«¯æ¸²æŸ“æ—¶ä¸€èˆ¬ html çš„ body ä¸­åªæœ‰ä¸€ä¸ª id ä¸º root çš„æ ‡ç­¾ï¼Œé¡µé¢åœ¨æµè§ˆå™¨ä¸Šæ¸²æŸ“å‡ºæ¥åï¼Œé€šè¿‡æ‰§è¡Œ JavaScript å°†é¡µé¢å†…å®¹æ’å…¥åˆ°è¿™ä¸ªæ ‡ç­¾ä¸­ã€‚è€ŒæœåŠ¡ç«¯æ¸²æŸ“åˆ™åœ¨æœåŠ¡å™¨ç«¯å°†é¡µé¢å†…å®¹æ’å…¥åˆ°è¿™ä¸ªæ ‡ç­¾ä¸­ï¼Œè¿”å›ç»™æµè§ˆå™¨çš„æ—¶å€™å°±å·²ç»æœ‰å®Œæ•´çš„é¡µé¢ç»“æ„äº†ã€‚</p>\n<p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯æ¸²æŸ“å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>\n<ol>\n<li>é¦–å±æ¸²æŸ“å¿«ï¼šè¿”å›çš„ html æ˜¯å®Œæ•´çš„ï¼Œä¸éœ€è¦å†å‘å…¶ä»–è¯·æ±‚æ¥ä¸æ–­åœ°å‘é¡µé¢å¡«å……å†…å®¹ï¼Œä¹Ÿä¸ä¼šåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­äº§ç”Ÿç™½å±æˆ–æŠ–åŠ¨ï¼Œç”¨æˆ·ä½“éªŒä¼šå¥½å¾ˆå¤š</li>\n<li>æœ‰åˆ©äº SEOï¼šReact å®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢ä¸­åªæœ‰ä¸€ä¸ª root æ ‡ç­¾ï¼Œæœç´¢å¼•æ“å¾ˆéš¾çˆ¬å–é¡µé¢å†…å®¹ï¼Œè€ŒæœåŠ¡ç«¯æ¸²æŸ“èƒ½ç»™æœç´¢å¼•æ“æ›´å¤šçš„æ•°æ®ï¼Œå› æ­¤èƒ½è·å¾—æ›´é«˜çš„æƒé‡å’Œæ’å</li>\n</ol>\n<p>æœåŠ¡ç«¯æ¸²æŸ“çš„è¿™äº›ä¼˜åŠ¿ï¼Œä¼´éšç€ä¸€å®šçš„ä»£ä»·ï¼š</p>\n<ol>\n<li>é¡¹ç›®æ¶æ„å˜å¾—å¤æ‚ï¼Œç»´æŠ¤æˆæœ¬æé«˜ï¼šå®¢æˆ·ç«¯æ¸²æŸ“æ—¶å‰ç«¯å·¥ç¨‹å¸ˆåªå…³æ³¨ JSï¼Œè€ŒåšæœåŠ¡ç«¯æ¸²æŸ“çš„è¯ï¼Œåˆ™ä¸ä»…éœ€è¦å…³æ³¨åŒæ„éƒ¨åˆ†çš„ä»£ç ï¼Œè¿˜è¦å…³æ³¨ Node æœåŠ¡ç«¯çš„ä»£ç ï¼›ä¸ä»…è¦ä¿è¯åŒæ„ä»£ç çš„æ­£å¸¸è¿è¡Œï¼Œè¿˜è¦ä¿è¯ Node æœåŠ¡ç¨³å®šã€‚å‰ç«¯çš„ Node æœåŠ¡éƒ¨ç½²ä¸Šå»ä¹‹åï¼Œéœ€è¦ä»˜å‡ºæ—¶é—´ç²¾åŠ›æ¥è¿›è¡ŒæœåŠ¡å™¨çš„è¿ç»´</li>\n<li>æœåŠ¡ç«¯æ‰§è¡Œ react æ€§èƒ½æ¶ˆè€—è¾ƒå¤§ï¼Œå¯¹ Node SSR æœåŠ¡å™¨æ€§èƒ½æŸè€—æ›´å¤šï¼Œå¯¹ç½‘é€Ÿã€å¹¶å‘æ•°éƒ½æ˜¯è€ƒéªŒ</li>\n</ol>\n<h2>äºŒã€ä»€ä¹ˆæ˜¯åŒæ„ï¼š</h2>\n<p>ç”¨åŒä¸€ä»½ä»£ç åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«æ‰§è¡Œä¸€æ¬¡ã€‚ä»£ç åœ¨æœåŠ¡ç«¯æ‰§è¡Œæ—¶æ¸²æŸ“äº†é¡µé¢ï¼Œåœ¨å®¢æˆ·ç«¯æ‰§è¡Œæ—¶æ¥ç®¡äº†é¡µé¢äº¤äº’ã€‚</p>\n<p>è¿™æ ·åšæ˜¯å› ä¸ºäº‹ä»¶ç»‘å®šå¤„ç†æ˜¯æµè§ˆå™¨çš„è¡Œä¸ºï¼ŒæœåŠ¡ç«¯ä»£ç åªèƒ½ç”Ÿæˆ html stringï¼Œè€Œå®¢æˆ·ç«¯ä»£ç æ‰§è¡Œçš„æ—¶å€™ä½¿ç”¨ ReactDOM.hydrate è¿›è¡Œäº‹ä»¶ç»‘å®šã€‚</p>\n<h2>ä¸‰ã€æ€æ ·å®ç°ï¼Ÿ</h2>\n<p>çœ‹å®Œäº†ä¸Šé¢è¿™äº›æ¦‚å¿µï¼Œæˆ‘ä»¬çŸ¥é“çœ‹äº† SSR çš„ä¼˜åŠ¿ï¼Œé‚£ä¹ˆå¦‚ä½•ç”¨ä»£ç å®ç°å‘¢ï¼Ÿ</p>\n<p>ä¸€ä¸ªæœ€ç®€å•çš„ï¼ŒåŸºäº Koa çš„ SSR å®ç°å¦‚ä¸‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> Koa <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'koa'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Koa</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>ctx <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`\n    &lt;html>\n      &lt;head>\n          &lt;title>title&lt;/title>\n      &lt;/head>\n      &lt;body>\n          hello SSR\n      &lt;/body>\n    &lt;/html>\n  `</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ç½‘é¡µä¸Šå±•ç¤ºçš„å†…å®¹éƒ½æ˜¯æœåŠ¡å™¨ç«¯è¿”å›çš„ï¼Œè¿™æ ·åªåšåˆ°äº†æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œæ²¡æœ‰åšåŒæ„å¤„ç†ï¼Œå½“é¡µé¢å¤æ‚ä¸€äº›ï¼Œæœ‰ä¸€äº›äº¤äº’çš„æ—¶å€™å°±ä¸è¡Œäº†ã€‚</p>\n<p>å¼•å…¥ React åŒæ„ä¹‹åï¼Œä¸€æ¬¡å®Œæ•´çš„ React åŒæ„ SSR ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p>\n<img src=\"/img/react-ssr/æµç¨‹.png\" style=\"width:100%; max-width: 661px;\" />\n<p>å…·ä½“æ€æ ·å®ç°å‘¢ï¼Ÿä¸‹é¢è®²ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤å’Œä¸€äº›ç»†èŠ‚ï¼š</p>\n<h3>1. åˆå§‹åŒ–ç›®å½•ä¸å…¥å£æ–‡ä»¶</h3>\n<p>æºä»£ç æ”¾åˆ° /src ç›®å½•ä¸‹ï¼Œæ–°å»º /src/containers/Home.js ä½œä¸ºé¦–é¡µï¼Œcontainers æ–‡ä»¶å¤¹ä¸‹æ”¾åŒæ„çš„ç»„ä»¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„å…¥å£æ–‡ä»¶éƒ½ä¼šå¼•ç”¨è¿™äº›ç»„ä»¶æ¥æ‹¼æˆé¡µé¢ï¼š</p>\n<p>ğŸ‘‡ /src/containers/Home.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Home</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Home page<span class=\"token punctuation\">.</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Home<span class=\"token punctuation\">;</span></code></pre></div>\n<p>åœ¨ /src ç›®å½•ä¸‹æ–°å»º client å’Œ server ç›®å½•ï¼Œåˆ†åˆ«å­˜æ”¾å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¼‚æ„çš„ä»£ç </p>\n<p>ğŸ‘‡ /src/client/index.js å®¢æˆ·ç«¯ä½¿ç”¨ containers ç›®å½•ä¸‹çš„ç»„ä»¶è¿›è¡Œ React ç»„ä»¶æ¸²æŸ“</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Home <span class=\"token keyword\">from</span> <span class=\"token string\">'./containers/Home'</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Home <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nReactDom<span class=\"token punctuation\">.</span><span class=\"token function\">hydrate</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ğŸ‘‡ /src/client/index.js æœåŠ¡å™¨ç«¯èµ·æœåŠ¡ï¼ŒåŒæ—¶ä½¿ç”¨ containers ç›®å½•ä¸‹çš„ç»„ä»¶ï¼Œä½¿ç”¨ react-dom/server æä¾›çš„ renderToString æ–¹æ³•æ¸²æŸ“é¡µé¢</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Koa <span class=\"token keyword\">from</span> <span class=\"token string\">'koa'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">Koa</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> Home <span class=\"token keyword\">from</span> <span class=\"token string\">'./containers/Home'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> renderToString <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom/server'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token function\">renderToString</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Home <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> ctx <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> htmlStr <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`\n    &lt;html>\n        &lt;head>\n            &lt;title>title&lt;/title>\n        &lt;/head>\n        &lt;body>\n            &lt;div id=\"root\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>content<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/div>\n            &lt;script src=\"/index.js\">&lt;/script>\n        &lt;/body>\n    &lt;/html>\n  `</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> htmlStr<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token string\">'3000'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'started!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>2. ç¯å¢ƒæ­å»º</h3>\n<p>å®‰è£…ä¾èµ–ï¼ˆreactã€react-domã€webpackã€babelç­‰ï¼‰ï¼Œä½¿ç”¨ webpack è¿›è¡Œæ‰“åŒ…ã€‚</p>\n<p>ä»ä¸Šé¢çš„æµç¨‹å›¾å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦æ‰“åŒ…ä¸¤ä»½ä»£ç ï¼šä¸€ä»½æ˜¯æœåŠ¡å™¨ç«¯ä»£ç ï¼Œç”¨äº Node ç«¯èµ·æœåŠ¡ã€æ¸²æŸ“é¡µé¢ï¼›å¦ä¸€ä»½æ˜¯æµè§ˆå™¨ç«¯æ‹¿åˆ° html æ–‡ä»¶åè¯·æ±‚çš„å®¢æˆ·ç«¯ä»£ç ï¼Œç”¨äºæ¥ç®¡é¡µé¢äº¤äº’ã€‚</p>\n<p>ğŸ‘‡ webpack.base.js å¯¼å‡ºå…¬ç”¨çš„ webpack é…ç½®</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js?$/</span><span class=\"token punctuation\">,</span>\n    loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n    exclude<span class=\"token punctuation\">:</span> <span class=\"token regex\">/node_modules/</span><span class=\"token punctuation\">,</span>\n    options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-react'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            targets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                browsers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'last 2 versions'</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>ğŸ‘‡ webpack.client.js å¯¼å‡ºå®¢æˆ·ç«¯çš„é…ç½®ï¼Œå…¥å£æ–‡ä»¶ä¸º /src/client/index.jsï¼Œå¯¼å‡ºåˆ° public ç›®å½•ä¸‹</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> merge <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'webpack-merge'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> base <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./webpack.base'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> clientConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    mode<span class=\"token punctuation\">:</span> <span class=\"token string\">'development'</span><span class=\"token punctuation\">,</span>\n    entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./src/client/index.js'</span><span class=\"token punctuation\">,</span>\n    output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'index.js'</span><span class=\"token punctuation\">,</span>\n        path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'public'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">,</span> clientConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// åœ¨server ç«¯è¿”å›çš„ html æ¨¡æ¿æ–‡ä»¶ä¸­å¼•å…¥å¯¼å‡ºçš„ index.js</span>\n<span class=\"token comment\">// è¿™æ ·æµè§ˆå™¨è¯·æ±‚é¡µé¢çš„æ—¶å€™ä¼šä¸‹è½½å®¢æˆ·ç«¯æ‰“åŒ…çš„ react ä»£ç ï¼Œè¿›è¡Œé¡µé¢æ¸²æŸ“ï¼Œæ¥ç®¡é¡µé¢äº¤äº’</span>\n<span class=\"token template-string\"><span class=\"token string\">`\n  &lt;script src=\"/index.js\">&lt;/script>\n`</span></span></code></pre></div>\n<p>ğŸ‘‡ webpack.server.js å¯¼å‡ºæœåŠ¡ç«¯çš„é…ç½®ï¼Œå…¥å£æ–‡ä»¶ä¸º /src/server/index.jsï¼Œå¯¼å‡ºåˆ° dist ç›®å½•ä¸‹</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> nodeExternals <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'webpack-node-externals'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> merge <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'webpack-merge'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./webpack.base'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> serverConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    target<span class=\"token punctuation\">:</span> <span class=\"token string\">'node'</span><span class=\"token punctuation\">,</span>\n    mode<span class=\"token punctuation\">:</span> <span class=\"token string\">'development'</span><span class=\"token punctuation\">,</span>\n    entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./src/server/index.js'</span><span class=\"token punctuation\">,</span>\n    output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'bundle.js'</span><span class=\"token punctuation\">,</span>\n        path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    externals<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">nodeExternals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> serverConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>æ³¨æ„é…ç½®ä¸­çš„ target ä¸º node æ˜¯å‘Šè¯‰ webpack æ‰“åŒ…çš„å¯¹è±¡æ˜¯ node ç«¯çš„ä»£ç ï¼Œè¿™æ ·ä¸€äº›åŸç”Ÿæ¨¡å—webpack å°±ä¸ä¼šåšå¤„ç†ã€‚</p>\n<p>é…ç½®ä¸­çš„ webpack çš„ externals å±æ€§æ˜¯å‘Šè¯‰ webpack åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œé‡åˆ° externals ä¸­å£°æ˜çš„æ¨¡å—ä¸ç”¨å¤„ç†ã€‚</p>\n<p>ä½¿ç”¨æ—¶è°ƒ node æ‰§è¡Œ /dist/bundle.js å³å¯èµ·æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£ï¼Œè¿”å›æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„é¡µé¢äº†ã€‚</p>\n<p>å…³äº Node ç«¯ä»£ç æ‰“åŒ…ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹å°çˆçš„è¿™ç¯‡æ–‡ç« ï¼š<a href=\"https://zhuanlan.zhihu.com/p/20782320\">https://zhuanlan.zhihu.com/p/20782320</a></p>\n<h3>3. æ•°æ®è„±æ°´å’Œæ³¨æ°´</h3>\n<p><strong>æœåŠ¡ç«¯æ¸²æŸ“åªå‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢çš„æ—¶å€™</strong>ï¼Œå†è·³è½¬çš„æ—¶å€™ä¸æ˜¯æœåŠ¡å™¨ç«¯è·³è½¬ï¼Œè€Œæ˜¯ JS æ§åˆ¶è·³è½¬ï¼ˆreact ä»£ç æ¥ç®¡ï¼‰ã€‚</p>\n<p>å› æ­¤é¦–æ¬¡æ¸²æŸ“åº”è¯¥åœ¨æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚ï¼ˆcomponentDidMount ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œå°†ç»“æœæ¸²æŸ“åˆ°é¡µé¢ä¸Šè¿”å›ï¼Œå¦åˆ™å®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢åå†è¯·æ±‚æ•°æ®ï¼Œé¡µé¢ä¼šæœ‰ç©ºç™½ã€‚</p>\n<p>æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚åï¼Œåº”è¯¥å°†è¯·æ±‚çš„ç»“æœå­˜èµ·æ¥ï¼Œäº¤ç»™å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨ï¼Œå®¢æˆ·ç«¯ä¸åº”è¯¥å†å‘è¯·æ±‚äº†ã€‚ä»¥ react-redux ä¸ºä¾‹ï¼Œè¯·æ±‚å›æ¥çš„æ•°æ®å­˜æ”¾åˆ° store ä¸­ï¼Œæ¸²æŸ“æ—¶ä¾æ® store ä¸­çš„æ•°æ®ï¼Œæ¸²æŸ“å…·ä½“åšæ³•æ˜¯ï¼š</p>\n<ol>\n<li>\n<p>æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œç»™ window æŒ‚ä¸€ä¸ª state = store.getState() <strong>ï¼ˆæ•°æ®æ³¨æ°´ï¼‰</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Home</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// åŒæ„éƒ¨åˆ†ä»£ç å°†æœåŠ¡å™¨ç«¯å‘çš„è¯·æ±‚ç‹¬ç«‹å‡ºæ¥ï¼ˆæˆ‘ä»¬åœ¨è¿™é‡Œå‘½åä¸º fetching æ–¹æ³•ï¼‰</span>\n<span class=\"token keyword\">static</span> <span class=\"token function-variable function\">fetching</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>dispatch<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">getListAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>æœåŠ¡ç«¯ä»£ç ä½¿ç”¨ react-router-config åŒ¹é…åˆ°æ‰€æ¸²æŸ“è·¯ç”±çš„ç»„ä»¶</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> matchRoutes <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-router-config'</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> matchedRoutes <span class=\"token operator\">=</span> <span class=\"token function\">matchRoutes</span><span class=\"token punctuation\">(</span>routes<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">getStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> promises <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// éå†è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶ä¸­çš„ fetching æ–¹æ³•</span>\n    matchedRoutes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>item <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>route<span class=\"token punctuation\">.</span>fetching<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ä»£ç ä¼˜åŒ–ï¼šå¤šä¸ª promise å…¶ä¸­æŸä¸ªæœ‰é”™è¯¯, èµ°ä¸åˆ° all é‡Œï¼Œè€Œæ˜¯ç›´æ¥è¿› catchï¼Œå…¶ä»–çš„è¯·æ±‚ä¼šä¸­æ–­</span>\n            <span class=\"token comment\">// å› æ­¤ç”¨ Promise å†åŒ…ä¸€å±‚ï¼Œè®©æ¯ä¸ª promise è¯·æ±‚çš„ catch éƒ½ resolve å›æ¥ï¼Œä¿è¯ä¸€å®šä¼šèµ°åˆ° all é‡Œ</span>\n            <span class=\"token keyword\">const</span> promise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                item<span class=\"token punctuation\">.</span>route<span class=\"token punctuation\">.</span><span class=\"token function\">fetching</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            promises<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// å‡½æ•°æ‰§è¡Œåå°†è¿”å›æ•°æ®å­˜åˆ° store</span>\n    <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>promises<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>error <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        ctx<span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// æœåŠ¡ç«¯æ¸²æŸ“æ—¶å€™ä½¿ç”¨è¿™ä¸ª store</span>\n    <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token function\">renderToString</span><span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>Provider store<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>store<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">...</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Provider<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// æ•°æ®æ³¨æ°´ï¼šæœåŠ¡ç«¯æ¸²æŸ“çš„ store å­˜åˆ° window.context ä¸‹é¢</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`\n        &lt;html>\n            &lt;body>\n                &lt;div id=\"root\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>content<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/div>\n                &lt;script>\n                    window.context = { state: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> }\n                &lt;/script>\n                &lt;script src=\"/index.js\" >&lt;/script>\n            &lt;/body>\n        &lt;/html>\n    `</span></span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>å®¢æˆ·ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œä» window.context æ‹¿å‡ºæ•°æ®ç›´æ¥ä½¿ç”¨ <strong>ï¼ˆæ•°æ®è„±æ°´ï¼‰</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// æ•°æ®è„±æ°´ï¼šå®¢æˆ·ç«¯æ¸²æŸ“åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°† window.context é‡Œçš„æ•°æ®ï¼ˆå³ SSR è¯·æ±‚è¿”å›çš„æ•°æ®ï¼‰ è„±æ°´ï¼Œå–å‡ºæ¥ï¼Œä½œä¸ºå®¢æˆ·ç«¯æ¸²æŸ“ store ä¸­çš„åˆå§‹å€¼</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getClientStore</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> defaultState <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>reducer<span class=\"token punctuation\">,</span> defaultState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ol>\n<p>æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¸èµ° fetching æ–¹æ³•ï¼Œåœ¨ componentDidMount çš„æ—¶å€™åˆ¤æ–­ list æ˜¯å¦æœ‰å€¼ï¼ˆä¹Ÿå¯ä»¥å­˜ä¸€ä¸ª flag æ ‡è®°æ˜¯å¦æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ï¼‰ï¼Œæœ‰å€¼çš„è¯ä¸å‘è¯·æ±‚ã€‚</p>\n<p>ä»å…¶ä»–é¡µé¢è·³è½¬è¿‡æ¥çš„æ—¶å€™ï¼Œä¸èµ°æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå› æ­¤ list æ²¡æœ‰å€¼ï¼Œè¿™æ—¶æ­£å¸¸å‘é€è¯·æ±‚ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Home</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// </span>\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">getHomeList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>4. æœåŠ¡ç«¯è¯·æ±‚å¸¦ä¸Š cookie</h3>\n<p>æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œä¸ä¼šåƒæµè§ˆå™¨ç«¯è¯·æ±‚é‚£æ ·æºå¸¦ cookie ç­‰ä¿¡æ¯</p>\n<p>è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨ axios çš„é…ç½®ä¸­åŠ ä¸Š headers cookieï¼Œå…¶ä»–æµè§ˆå™¨ç«¯çš„ä¿¡æ¯ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§å½¢å¼å¼•å…¥</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">axios<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        cookie<span class=\"token punctuation\">:</span> req<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cookie'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">''</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>5. CSS æœåŠ¡å™¨ç«¯æ¸²æŸ“</h3>\n<p>æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¸åªåŒ…å« DOM ç»“æ„å’Œé¡µé¢äº¤äº’ï¼Œè¿˜åŒ…æ‰© CSSï¼Œå¦‚æœæœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ—¶å€™ä¸æ¸²æŸ“æ ·å¼ï¼Œé‚£ä¹ˆé¡µé¢åŠ è½½çš„æ—¶å€™ä¼šæœ‰æŠ–åŠ¨ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œsrc/containers/Home ç»„ä»¶ä¸‹å¼•å…¥ CSSï¼Œç»™ body è®¾ç½®èƒŒæ™¯è‰²ï¼Œæ‰“åŒ…åé¡µé¢é¦–æ¬¡æ¸²æŸ“å‡ºæ¥æ˜¯æ²¡æœ‰èƒŒæ™¯è‰²çš„ï¼Œæ‰§è¡Œ index.js æ—¶ JS å°† CSS æ¨¡å—çš„ä»£ç æ’å…¥åˆ° style æ ‡ç­¾ä¸­ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶æ‰ä¼šæœ‰èƒŒæ™¯è‰²ï¼Œæ‰“å¼€æ§åˆ¶å°çš„ Performance é¢æ¿å¯ä»¥çœ‹åˆ°æ¸²æŸ“çš„è¯¦ç»†è¿‡ç¨‹ï¼š</p>\n<img src=\"/img/react-ssr/performance.png\" style=\"width:100%; \" />\n<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ—¶å€™å°† CSS ä»£ç æ’å…¥åˆ° style æ ‡ç­¾ä¸­è¿”å›ã€‚</p>\n<p>åœ¨ webpack.client.js ä¸­é…ç½® style-loader &#x26;&#x26; css-loader å¯ä»¥æ”¯æŒå¼•å…¥ css æ¨¡å—ï¼Œä½†æ˜¯åœ¨ webpack.server.js ä¸­è¿™æ ·é…ç½®åˆ™ build æ—¶ä¼šæŠ¥é”™ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">webpack<span class=\"token punctuation\">:</span>///./node_modules/style<span class=\"token punctuation\">-</span>loader/dist/runtime/injectStylesIntoStyleTag.js<span class=\"token punctuation\">?</span><span class=\"token punctuation\">:</span><span class=\"token number\">93</span>\n  var style = document.createElement('style');\n              ^\n<span class=\"token key atrule\">ReferenceError</span><span class=\"token punctuation\">:</span> document is not defined</code></pre></div>\n<p>è¿™æ˜¯å› ä¸ºæœåŠ¡ç«¯ç¯å¢ƒæ²¡æœ‰å…¨å±€å˜é‡ windowï¼Œå°† style-loader æ›¿æ¢æˆ <a href=\"https://github.com/kriasoft/isomorphic-style-loader\">isomorphic-style-loader</a> è¿™ä¸ªæ¨¡å—å¯ä»¥å¸®æˆ‘ä»¬è·å–åˆ°æ‰€æœ‰æ¨¡å—çš„ CSS ä»£ç ï¼Œä½¿ç”¨ insertCss æ–¹æ³•å°†è¿™äº›ä»£ç æ’å…¥åˆ° style æ ‡ç­¾ä¸­ã€‚</p>\n<h3>6. meta tags æ¸²æŸ“</h3>\n<p>ä½¿ç”¨ <a href=\"https://github.com/nfl/react-helmet\">React-helmet</a> </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>Helmet<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span>Another Title<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>Helmet<span class=\"token operator\">></span></code></pre></div>\n<ol start=\"5\">\n<li>meta tags æ¸²æŸ“</li>\n<li>403ã€404 å¤„ç†</li>\n<li>å®‰å…¨é—®é¢˜</li>\n<li>æ€§èƒ½ä¼˜åŒ–</li>\n</ol>\n<h2>æ€è€ƒ</h2>\n<p>Node åšä¸ºä¸­é—´å±‚ï¼Œåšäº†è¿™å‡ ä»¶äº‹ï¼š</p>\n<ol>\n<li>åœ¨æœåŠ¡ç«¯æ¸²æŸ“ React ä»£ç </li>\n<li>è¿›è¡Œå·¥ç¨‹è§£è€¦ï¼Œæœ‰åˆ©äºæ’æŸ¥é”™è¯¯</li>\n<li>æœåŠ¡ç«¯æ‰§è¡Œ react æ€§èƒ½æ¶ˆè€—è¾ƒå¤§ï¼Œå› æ­¤å°† Node æœåŠ¡å•ç‹¬åˆ†å‡ºæ¥ï¼Œè´Ÿè½½é‡åˆ°ç“¶é¢ˆæ—¶å¯ä»¥å•ç‹¬åŠ  Node æœºå™¨æ¥è§£å†³</li>\n<li>æ¥å£ä»£ç†ä¸è½¬å‘ï¼šè§£å†³è·¨åŸŸé—®é¢˜</li>\n</ol>","frontmatter":{"title":"æµ…è°ˆ React æœåŠ¡ç«¯æ¸²æŸ“ä¸åŒæ„","date":"May 28, 2020"},"excerpt":"ä¸€ã€ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¸²æŸ“ï¼š æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰åŒºåˆ«äºå®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰ï¼Œå½“ç”¨æˆ·è®¿é—®ä¸€ä¸ªç½‘å€çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯æ¸²æŸ“åˆ™æ˜¯æœåŠ¡ç«¯è¿”å›ä¸€éƒ¨åˆ† HTML ç»“æ„ï¼Œé€šè¿‡æ‰§è¡Œ JavaScript å°†ä½™ä¸‹çš„ HTML æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼Œè€ŒæœåŠ¡ç«¯æ¸²æŸ“åˆ™æ˜¯åœ¨æœåŠ¡ç«¯ç”Ÿæˆå®Œæ•´çš„ HTML ç»“æ„è¿”å›ç»™æµè§ˆå™¨ã€‚\nä»¥ React ä¸ºä¾‹ï¼šåœ¨å®¢æˆ·ç«¯æ¸²æŸ“æ—¶ä¸€èˆ¬ html çš„ body ä¸­åªæœ‰ä¸€ä¸ª id ä¸º root çš„æ ‡ç­¾ï¼Œé¡µé¢åœ¨æµè§ˆå™¨ä¸Šæ¸²æŸ“å‡ºæ¥åï¼Œé€šè¿‡æ‰§è¡Œ JavaScriptâ€¦"}},"pageContext":{"slug":"/blog/react-ssr/","previous":{"fields":{"slug":"/reading/2019-07-25-js-you-dont-know-1/"},"frontmatter":{"title":"ä½ ä¸çŸ¥é“çš„ JavaScript (ä¸Š)","type":"reading","photos":null,"tags":["JS"],"process":[100,100]}},"next":{"fields":{"slug":"/about/"},"frontmatter":{"title":"","type":"other","photos":null,"tags":null,"process":null}}}}